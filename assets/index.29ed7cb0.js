(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const l of s)if(l.type==="childList")for(const o of l.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function n(s){const l={};return s.integrity&&(l.integrity=s.integrity),s.referrerpolicy&&(l.referrerPolicy=s.referrerpolicy),s.crossorigin==="use-credentials"?l.credentials="include":s.crossorigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function r(s){if(s.ep)return;s.ep=!0;const l=n(s);fetch(s.href,l)}})();const Te={};let Wr=Tn;const Se=1,Ye=2,Nn={owned:null,cleanups:null,context:null,owner:null};var K=null;let ke=null,W=null,F=null,ce=null,Yt=0;function Zr(e,t){const n=W,r=K,s=e.length===0,l=s?Nn:{owned:null,cleanups:null,context:null,owner:t||r},o=s?e:()=>e(()=>Xt(()=>Gt(l)));K=l,W=null;try{return dt(o,!0)}finally{W=n,K=r}}function Ot(e,t,n){const r=ts(e,t,!1,Se);Mn(r)}function Xt(e){let t,n=W;return W=null,t=e(),W=n,t}function Jr(e,t,n){let r=e.value;return(!e.comparator||!e.comparator(r,t))&&(e.value=t,e.observers&&e.observers.length&&dt(()=>{for(let s=0;s<e.observers.length;s+=1){const l=e.observers[s],o=ke&&ke.running;o&&ke.disposed.has(l),(o&&!l.tState||!o&&!l.state)&&(l.pure?F.push(l):ce.push(l),l.observers&&Bn(l)),o||(l.state=Se)}if(F.length>1e6)throw F=[],new Error},!1)),t}function Mn(e){if(!e.fn)return;Gt(e);const t=K,n=W,r=Yt;W=K=e,es(e,e.value,r),W=n,K=t}function es(e,t,n){let r;try{r=e.fn(t)}catch(s){e.pure&&(e.state=Se),On(s)}(!e.updatedAt||e.updatedAt<=n)&&(e.updatedAt!=null&&"observers"in e?Jr(e,r):e.value=r,e.updatedAt=n)}function ts(e,t,n,r=Se,s){const l={fn:e,state:r,updatedAt:null,owned:null,sources:null,sourceSlots:null,cleanups:null,value:t,owner:K,context:null,pure:n};return K===null||K!==Nn&&(K.owned?K.owned.push(l):K.owned=[l]),l}function jn(e){const t=ke;if(e.state===0||t)return;if(e.state===Ye||t)return Lt(e);if(e.suspense&&Xt(e.suspense.inFallback))return e.suspense.effects.push(e);const n=[e];for(;(e=e.owner)&&(!e.updatedAt||e.updatedAt<Yt);)(e.state||t)&&n.push(e);for(let r=n.length-1;r>=0;r--)if(e=n[r],e.state===Se||t)Mn(e);else if(e.state===Ye||t){const s=F;F=null,dt(()=>Lt(e,n[0]),!1),F=s}}function dt(e,t){if(F)return e();let n=!1;t||(F=[]),ce?n=!0:ce=[],Yt++;try{const r=e();return ns(n),r}catch(r){F||(ce=null),On(r)}}function ns(e){if(F&&(Tn(F),F=null),e)return;const t=ce;ce=null,t.length&&dt(()=>Wr(t),!1)}function Tn(e){for(let t=0;t<e.length;t++)jn(e[t])}function Lt(e,t){const n=ke;e.state=0;for(let r=0;r<e.sources.length;r+=1){const s=e.sources[r];s.sources&&(s.state===Se||n?s!==t&&jn(s):(s.state===Ye||n)&&Lt(s,t))}}function Bn(e){const t=ke;for(let n=0;n<e.observers.length;n+=1){const r=e.observers[n];(!r.state||t)&&(r.state=Ye,r.pure?F.push(r):ce.push(r),r.observers&&Bn(r))}}function Gt(e){let t;if(e.sources)for(;e.sources.length;){const n=e.sources.pop(),r=e.sourceSlots.pop(),s=n.observers;if(s&&s.length){const l=s.pop(),o=n.observerSlots.pop();r<s.length&&(l.sourceSlots[o]=r,s[r]=l,n.observerSlots[r]=o)}}if(e.owned){for(t=0;t<e.owned.length;t++)Gt(e.owned[t]);e.owned=null}if(e.cleanups){for(t=0;t<e.cleanups.length;t++)e.cleanups[t]();e.cleanups=null}e.state=0,e.context=null}function rs(e){return e instanceof Error||typeof e=="string"?e:new Error("Unknown error")}function On(e){throw e=rs(e),e}function Ln(e,t){return Xt(()=>e(t||{}))}function ss(e,t,n){let r=n.length,s=t.length,l=r,o=0,i=0,a=t[s-1].nextSibling,u=null;for(;o<s||i<l;){if(t[o]===n[i]){o++,i++;continue}for(;t[s-1]===n[l-1];)s--,l--;if(s===o){const c=l<r?i?n[i-1].nextSibling:n[l-i]:a;for(;i<l;)e.insertBefore(n[i++],c)}else if(l===i)for(;o<s;)(!u||!u.has(t[o]))&&t[o].remove(),o++;else if(t[o]===n[l-1]&&n[i]===t[s-1]){const c=t[--s].nextSibling;e.insertBefore(n[i++],t[o++].nextSibling),e.insertBefore(n[--l],c),t[s]=n[l]}else{if(!u){u=new Map;let f=i;for(;f<l;)u.set(n[f],f++)}const c=u.get(t[o]);if(c!=null)if(i<c&&c<l){let f=o,h=1,d;for(;++f<s&&f<l&&!((d=u.get(t[f]))==null||d!==c+h);)h++;if(h>c-i){const p=t[o];for(;i<c;)e.insertBefore(n[i++],p)}else e.replaceChild(n[i++],t[o++])}else o++;else t[o++].remove()}}}function is(e,t,n){let r;return Zr(s=>{r=s,t===document?e():ls(t,e(),t.firstChild?null:void 0,n)}),()=>{r(),t.textContent=""}}function ls(e,t,n,r){if(n!==void 0&&!r&&(r=[]),typeof t!="function")return Xe(e,t,r,n);Ot(s=>Xe(e,t(),s,n),r)}function Xe(e,t,n,r,s){for(Te.context&&!n&&(n=[...e.childNodes]);typeof n=="function";)n=n();if(t===n)return n;const l=typeof t,o=r!==void 0;if(e=o&&n[0]&&n[0].parentNode||e,l==="string"||l==="number"){if(Te.context)return n;if(l==="number"&&(t=t.toString()),o){let i=n[0];i&&i.nodeType===3?i.data=t:i=document.createTextNode(t),n=me(e,n,r,i)}else n!==""&&typeof n=="string"?n=e.firstChild.data=t:n=e.textContent=t}else if(t==null||l==="boolean"){if(Te.context)return n;n=me(e,n,r)}else{if(l==="function")return Ot(()=>{let i=t();for(;typeof i=="function";)i=i();n=Xe(e,i,n,r)}),()=>n;if(Array.isArray(t)){const i=[],a=n&&Array.isArray(n);if(qt(i,t,n,s))return Ot(()=>n=Xe(e,i,n,r,!0)),()=>n;if(Te.context){if(!i.length)return n;for(let u=0;u<i.length;u++)if(i[u].parentNode)return n=i}if(i.length===0){if(n=me(e,n,r),o)return n}else a?n.length===0?hn(e,i,r):ss(e,n,i):(n&&me(e),hn(e,i));n=i}else if(t instanceof Node){if(Te.context&&t.parentNode)return n=o?[t]:t;if(Array.isArray(n)){if(o)return n=me(e,n,r,t);me(e,n,null,t)}else n==null||n===""||!e.firstChild?e.appendChild(t):e.replaceChild(t,e.firstChild);n=t}}return n}function qt(e,t,n,r){let s=!1;for(let l=0,o=t.length;l<o;l++){let i=t[l],a=n&&n[l];if(i instanceof Node)e.push(i);else if(!(i==null||i===!0||i===!1))if(Array.isArray(i))s=qt(e,i,a)||s;else if(typeof i=="function")if(r){for(;typeof i=="function";)i=i();s=qt(e,Array.isArray(i)?i:[i],Array.isArray(a)?a:[a])||s}else e.push(i),s=!0;else{const u=String(i);a&&a.nodeType===3&&a.data===u?e.push(a):e.push(document.createTextNode(u))}}return s}function hn(e,t,n){for(let r=0,s=t.length;r<s;r++)e.insertBefore(t[r],n)}function me(e,t,n,r){if(n===void 0)return e.textContent="";const s=r||document.createTextNode("");if(t.length){let l=!1;for(let o=t.length-1;o>=0;o--){const i=t[o];if(s!==i){const a=i.parentNode===e;!l&&!o?a?e.replaceChild(s,i):e.insertBefore(s,n):a&&i.remove()}else l=!0}}else e.insertBefore(s,n);return[s]}const b={};function os(e){b.context=e}const as=(e,t)=>e===t,us=Symbol("solid-proxy"),qn=Symbol("solid-track"),Ge={equals:as};let Pn=Fn;const ee=1,Qe=2,Rn={owned:null,cleanups:null,context:null,owner:null},St={};var q=null;let fe=null,C=null,P=null,Z=null,Qt=0;function Le(e,t){const n=C,r=q,s=e.length===0,l=s?Rn:{owned:null,cleanups:null,context:null,owner:t||r},o=s?e:()=>e(()=>V(()=>Wt(l)));q=l,C=null;try{return pe(o,!0)}finally{C=n,q=r}}function M(e,t){t=t?Object.assign({},Ge,t):Ge;const n={value:e,observers:null,observerSlots:null,comparator:t.equals||void 0},r=s=>(typeof s=="function"&&(s=s(n.value)),In(n,s));return[Dn.bind(n),r]}function dn(e,t,n){const r=pt(e,t,!0,ee);Ce(r)}function j(e,t,n){const r=pt(e,t,!1,ee);Ce(r)}function he(e,t,n){Pn=ps;const r=pt(e,t,!1,ee);r.user=!0,Z?Z.push(r):Ce(r)}function _(e,t,n){n=n?Object.assign({},Ge,n):Ge;const r=pt(e,t,!0,0);return r.observers=null,r.observerSlots=null,r.comparator=n.equals||void 0,Ce(r),Dn.bind(r)}function cs(e,t,n){let r,s,l;arguments.length===2&&typeof t=="object"||arguments.length===1?(r=!0,s=e,l=t||{}):(r=e,s=t,l=n||{});let o=null,i=St,a=null,u=!1,c="initialValue"in l,f=typeof r=="function"&&_(r);const h=new Set,[d,p]=(l.storage||M)(l.initialValue),[g,m]=M(void 0),[y,S]=M(void 0,{equals:!1}),[v,A]=M(c?"ready":"unresolved");if(b.context){a=`${b.context.id}${b.context.count++}`;let E;l.ssrLoadFrom==="initial"?i=l.initialValue:b.load&&(E=b.load(a))&&(i=E[0])}function x(E,U,B,je){return o===E&&(o=null,c=!0,(E===i||U===i)&&l.onHydrated&&queueMicrotask(()=>l.onHydrated(je,{value:U})),i=St,Q(U,B)),U}function Q(E,U){pe(()=>{U||p(()=>E),m(U),A(U?"errored":"ready");for(const B of h.keys())B.decrement();h.clear()},!1)}function oe(){const E=fs,U=d(),B=g();if(B&&!o)throw B;return C&&!C.user&&E&&dn(()=>{y(),o&&(E.resolved||h.has(E)||(E.increment(),h.add(E)))}),U}function Et(E=!0){if(E!==!1&&u)return;u=!1;const U=f?f():r;if(U==null||U===!1){x(o,V(d));return}const B=i!==St?i:V(()=>s(U,{value:d(),refetching:E}));return typeof B!="object"||!(B&&"then"in B)?(x(o,B),B):(o=B,u=!0,queueMicrotask(()=>u=!1),pe(()=>{A(c?"refreshing":"pending"),S()},!1),B.then(je=>x(B,je,void 0,U),je=>x(B,void 0,Vn(je))))}return Object.defineProperties(oe,{state:{get:()=>v()},error:{get:()=>g()},loading:{get(){const E=v();return E==="pending"||E==="refreshing"}},latest:{get(){if(!c)return oe();const E=g();if(E&&!o)throw E;return d()}}}),f?dn(()=>Et(!1)):Et(!1),[oe,{refetch:Et,mutate:p}]}function V(e){let t,n=C;return C=null,t=e(),C=n,t}function Un(e,t,n){const r=Array.isArray(e);let s,l=n&&n.defer;return o=>{let i;if(r){i=Array(e.length);for(let u=0;u<e.length;u++)i[u]=e[u]()}else i=e();if(l){l=!1;return}const a=V(()=>t(i,s,o));return s=i,a}}function Re(e){return q===null||(q.cleanups===null?q.cleanups=[e]:q.cleanups.push(e)),e}let fs;function Dn(){const e=fe;if(this.sources&&(this.state||e))if(this.state===ee||e)Ce(this);else{const t=P;P=null,pe(()=>Ze(this),!1),P=t}if(C){const t=this.observers?this.observers.length:0;C.sources?(C.sources.push(this),C.sourceSlots.push(t)):(C.sources=[this],C.sourceSlots=[t]),this.observers?(this.observers.push(C),this.observerSlots.push(C.sources.length-1)):(this.observers=[C],this.observerSlots=[C.sources.length-1])}return this.value}function In(e,t,n){let r=e.value;return(!e.comparator||!e.comparator(r,t))&&(e.value=t,e.observers&&e.observers.length&&pe(()=>{for(let s=0;s<e.observers.length;s+=1){const l=e.observers[s],o=fe&&fe.running;o&&fe.disposed.has(l),(o&&!l.tState||!o&&!l.state)&&(l.pure?P.push(l):Z.push(l),l.observers&&Kn(l)),o||(l.state=ee)}if(P.length>1e6)throw P=[],new Error},!1)),t}function Ce(e){if(!e.fn)return;Wt(e);const t=q,n=C,r=Qt;C=q=e,hs(e,e.value,r),C=n,q=t}function hs(e,t,n){let r;try{r=e.fn(t)}catch(s){e.pure&&(e.state=ee),zn(s)}(!e.updatedAt||e.updatedAt<=n)&&(e.updatedAt!=null&&"observers"in e?In(e,r):e.value=r,e.updatedAt=n)}function pt(e,t,n,r=ee,s){const l={fn:e,state:r,updatedAt:null,owned:null,sources:null,sourceSlots:null,cleanups:null,value:t,owner:q,context:null,pure:n};return q===null||q!==Rn&&(q.owned?q.owned.push(l):q.owned=[l]),l}function We(e){const t=fe;if(e.state===0||t)return;if(e.state===Qe||t)return Ze(e);if(e.suspense&&V(e.suspense.inFallback))return e.suspense.effects.push(e);const n=[e];for(;(e=e.owner)&&(!e.updatedAt||e.updatedAt<Qt);)(e.state||t)&&n.push(e);for(let r=n.length-1;r>=0;r--)if(e=n[r],e.state===ee||t)Ce(e);else if(e.state===Qe||t){const s=P;P=null,pe(()=>Ze(e,n[0]),!1),P=s}}function pe(e,t){if(P)return e();let n=!1;t||(P=[]),Z?n=!0:Z=[],Qt++;try{const r=e();return ds(n),r}catch(r){P||(Z=null),zn(r)}}function ds(e){if(P&&(Fn(P),P=null),e)return;const t=Z;Z=null,t.length&&pe(()=>Pn(t),!1)}function Fn(e){for(let t=0;t<e.length;t++)We(e[t])}function ps(e){let t,n=0;for(t=0;t<e.length;t++){const r=e[t];r.user?e[n++]=r:We(r)}for(b.context&&os(),t=0;t<n;t++)We(e[t])}function Ze(e,t){const n=fe;e.state=0;for(let r=0;r<e.sources.length;r+=1){const s=e.sources[r];s.sources&&(s.state===ee||n?s!==t&&We(s):(s.state===Qe||n)&&Ze(s,t))}}function Kn(e){const t=fe;for(let n=0;n<e.observers.length;n+=1){const r=e.observers[n];(!r.state||t)&&(r.state=Qe,r.pure?P.push(r):Z.push(r),r.observers&&Kn(r))}}function Wt(e){let t;if(e.sources)for(;e.sources.length;){const n=e.sources.pop(),r=e.sourceSlots.pop(),s=n.observers;if(s&&s.length){const l=s.pop(),o=n.observerSlots.pop();r<s.length&&(l.sourceSlots[o]=r,s[r]=l,n.observerSlots[r]=o)}}if(e.owned){for(t=0;t<e.owned.length;t++)Wt(e.owned[t]);e.owned=null}if(e.cleanups){for(t=0;t<e.cleanups.length;t++)e.cleanups[t]();e.cleanups=null}e.state=0,e.context=null}function Vn(e){return e instanceof Error||typeof e=="string"?e:new Error("Unknown error")}function zn(e){throw e=Vn(e),e}const Pt=Symbol("fallback");function Je(e){for(let t=0;t<e.length;t++)e[t]()}function $e(e,t,n={}){let r=[],s=[],l=[],o=0,i=t.length>1?[]:null;return Re(()=>Je(l)),()=>{let a=e()||[],u,c;return a[qn],V(()=>{let h=a.length,d,p,g,m,y,S,v,A,x;if(h===0)o!==0&&(Je(l),l=[],r=[],s=[],o=0,i&&(i=[])),n.fallback&&(r=[Pt],s[0]=Le(Q=>(l[0]=Q,n.fallback())),o=1);else if(o===0){for(s=new Array(h),c=0;c<h;c++)r[c]=a[c],s[c]=Le(f);o=h}else{for(g=new Array(h),m=new Array(h),i&&(y=new Array(h)),S=0,v=Math.min(o,h);S<v&&r[S]===a[S];S++);for(v=o-1,A=h-1;v>=S&&A>=S&&r[v]===a[A];v--,A--)g[A]=s[v],m[A]=l[v],i&&(y[A]=i[v]);for(d=new Map,p=new Array(A+1),c=A;c>=S;c--)x=a[c],u=d.get(x),p[c]=u===void 0?-1:u,d.set(x,c);for(u=S;u<=v;u++)x=r[u],c=d.get(x),c!==void 0&&c!==-1?(g[c]=s[u],m[c]=l[u],i&&(y[c]=i[u]),c=p[c],d.set(x,c)):l[u]();for(c=S;c<h;c++)c in g?(s[c]=g[c],l[c]=m[c],i&&(i[c]=y[c],i[c](c))):s[c]=Le(f);s=s.slice(0,o=h),r=a.slice(0)}return s});function f(h){if(l[c]=h,i){const[d,p]=M(c);return i[c]=p,t(a[c],d)}return t(a[c])}}}function gs(e,t,n={}){let r=[],s=[],l=[],o=[],i=0,a;return Re(()=>Je(l)),()=>{const u=e()||[];return u[qn],V(()=>{if(u.length===0)return i!==0&&(Je(l),l=[],r=[],s=[],i=0,o=[]),n.fallback&&(r=[Pt],s[0]=Le(f=>(l[0]=f,n.fallback())),i=1),s;for(r[0]===Pt&&(l[0](),l=[],r=[],s=[],i=0),a=0;a<u.length;a++)a<r.length&&r[a]!==u[a]?o[a](()=>u[a]):a>=r.length&&(s[a]=Le(c));for(;a<r.length;a++)l[a]();return i=o.length=l.length=u.length,r=u.slice(0),s=s.slice(0,i)});function c(f){l[a]=f;const[h,d]=M(u[a]);return o[a]=d,t(h,a)}}}function w(e,t){return V(()=>e(t||{}))}function Ie(){return!0}const _s={get(e,t,n){return t===us?n:e.get(t)},has(e,t){return e.has(t)},set:Ie,deleteProperty:Ie,getOwnPropertyDescriptor(e,t){return{configurable:!0,enumerable:!0,get(){return e.get(t)},set:Ie,deleteProperty:Ie}},ownKeys(e){return e.keys()}};function Ct(e){return(e=typeof e=="function"?e():e)==null?{}:e}function Ve(...e){return new Proxy({get(t){for(let n=e.length-1;n>=0;n--){const r=Ct(e[n])[t];if(r!==void 0)return r}},has(t){for(let n=e.length-1;n>=0;n--)if(t in Ct(e[n]))return!0;return!1},keys(){const t=[];for(let n=0;n<e.length;n++)t.push(...Object.keys(Ct(e[n])));return[...new Set(t)]}},_s)}function ne(e){const t="fallback"in e&&{fallback:()=>e.fallback};return _($e(()=>e.each,e.children,t||void 0))}function pn(e){const t="fallback"in e&&{fallback:()=>e.fallback};return _(gs(()=>e.each,e.children,t||void 0))}function Zt(e){let t=!1;const n=e.keyed,r=_(()=>e.when,void 0,{equals:(s,l)=>t?s===l:!s==!l});return _(()=>{const s=r();if(s){const l=e.children,o=typeof l=="function"&&l.length>0;return t=n||o,o?V(()=>l(s)):l}return e.fallback})}const vs=(e,t)=>e===t,et={equals:vs};let Hn=Zn;const _e=1,tt=2,ms={owned:null,cleanups:null,context:null,owner:null};var I=null;let de=null,L=null,R=null,J=null,Jt=0;function gn(e,t){t=t?Object.assign({},et,t):et;const n={value:e,observers:null,observerSlots:null,comparator:t.equals||void 0},r=s=>(typeof s=="function"&&(s=s(n.value)),Qn(n,s));return[Gn.bind(n),r]}function ys(e,t,n){Hn=$s;const r=Wn(e,t,!1,_e);r.user=!0,J?J.push(r):gt(r)}function Be(e,t,n){n=n?Object.assign({},et,n):et;const r=Wn(e,t,!0,0);return r.observers=null,r.observerSlots=null,r.comparator=n.equals||void 0,gt(r),Gn.bind(r)}function Yn(e){let t,n=L;return L=null,t=e(),L=n,t}function bs(e,t,n){const r=Array.isArray(e);let s,l=n&&n.defer;return o=>{let i;if(r){i=Array(e.length);for(let u=0;u<e.length;u++)i[u]=e[u]()}else i=e();if(l){l=!1;return}const a=Yn(()=>t(i,s,o));return s=i,a}}function Xn(e){return I===null||(I.cleanups===null?I.cleanups=[e]:I.cleanups.push(e)),e}function Gn(){const e=de;if(this.sources&&(this.state||e))if(this.state===_e||e)gt(this);else{const t=R;R=null,_t(()=>rt(this),!1),R=t}if(L){const t=this.observers?this.observers.length:0;L.sources?(L.sources.push(this),L.sourceSlots.push(t)):(L.sources=[this],L.sourceSlots=[t]),this.observers?(this.observers.push(L),this.observerSlots.push(L.sources.length-1)):(this.observers=[L],this.observerSlots=[L.sources.length-1])}return this.value}function Qn(e,t,n){let r=e.value;return(!e.comparator||!e.comparator(r,t))&&(e.value=t,e.observers&&e.observers.length&&_t(()=>{for(let s=0;s<e.observers.length;s+=1){const l=e.observers[s],o=de&&de.running;o&&de.disposed.has(l),(o&&!l.tState||!o&&!l.state)&&(l.pure?R.push(l):J.push(l),l.observers&&Jn(l)),o||(l.state=_e)}if(R.length>1e6)throw R=[],new Error},!1)),t}function gt(e){if(!e.fn)return;er(e);const t=I,n=L,r=Jt;L=I=e,ws(e,e.value,r),L=n,I=t}function ws(e,t,n){let r;try{r=e.fn(t)}catch(s){e.pure&&(e.state=_e),tr(s)}(!e.updatedAt||e.updatedAt<=n)&&(e.updatedAt!=null&&"observers"in e?Qn(e,r):e.value=r,e.updatedAt=n)}function Wn(e,t,n,r=_e,s){const l={fn:e,state:r,updatedAt:null,owned:null,sources:null,sourceSlots:null,cleanups:null,value:t,owner:I,context:null,pure:n};return I===null||I!==ms&&(I.owned?I.owned.push(l):I.owned=[l]),l}function nt(e){const t=de;if(e.state===0||t)return;if(e.state===tt||t)return rt(e);if(e.suspense&&Yn(e.suspense.inFallback))return e.suspense.effects.push(e);const n=[e];for(;(e=e.owner)&&(!e.updatedAt||e.updatedAt<Jt);)(e.state||t)&&n.push(e);for(let r=n.length-1;r>=0;r--)if(e=n[r],e.state===_e||t)gt(e);else if(e.state===tt||t){const s=R;R=null,_t(()=>rt(e,n[0]),!1),R=s}}function _t(e,t){if(R)return e();let n=!1;t||(R=[]),J?n=!0:J=[],Jt++;try{const r=e();return xs(n),r}catch(r){R||(J=null),tr(r)}}function xs(e){if(R&&(Zn(R),R=null),e)return;const t=J;J=null,t.length&&_t(()=>Hn(t),!1)}function Zn(e){for(let t=0;t<e.length;t++)nt(e[t])}function $s(e){let t,n=0;for(t=0;t<e.length;t++){const r=e[t];r.user?e[n++]=r:nt(r)}for(t=0;t<n;t++)nt(e[t])}function rt(e,t){const n=de;e.state=0;for(let r=0;r<e.sources.length;r+=1){const s=e.sources[r];s.sources&&(s.state===_e||n?s!==t&&nt(s):(s.state===tt||n)&&rt(s,t))}}function Jn(e){const t=de;for(let n=0;n<e.observers.length;n+=1){const r=e.observers[n];(!r.state||t)&&(r.state=tt,r.pure?R.push(r):J.push(r),r.observers&&Jn(r))}}function er(e){let t;if(e.sources)for(;e.sources.length;){const n=e.sources.pop(),r=e.sourceSlots.pop(),s=n.observers;if(s&&s.length){const l=s.pop(),o=n.observerSlots.pop();r<s.length&&(l.sourceSlots[o]=r,s[r]=l,n.observerSlots[r]=o)}}if(e.owned){for(t=0;t<e.owned.length;t++)er(e.owned[t]);e.owned=null}if(e.cleanups){for(t=0;t<e.cleanups.length;t++)e.cleanups[t]();e.cleanups=null}e.state=0,e.context=null}function ks(e){return e instanceof Error||typeof e=="string"?e:new Error("Unknown error")}function tr(e){throw e=ks(e),e}var As=Object.defineProperty,Es=(e,t,n)=>t in e?As(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,re=(e,t,n)=>(Es(e,typeof t!="symbol"?t+"":t,n),n);function nr(e,t){let n=0;return rr((r,s)=>{n+=r;let l=Math.min(1,n/e);if(t(r,s,l),l===1)return!0})}function rr(e){let t,n=16.666666666666668,r,s=n,l=n*2,o=n;function i(a){let u=r?a-r:n;u=Math.min(l,Math.max(s,u)),!e(u,o)&&(o=u,r=a,t=requestAnimationFrame(i))}return t=requestAnimationFrame(i),()=>{cancelAnimationFrame(t)}}function N(e,t){if(typeof t=="function")return e[1](t);e[1](n=>t)}function Nt(e,t){return e[1](n=>(t(n),n))}function k(e){return Array.isArray(e)?e[0]():e()}const O=class{static get unit(){return new O(1,1)}static get zero(){return new O(0,0)}get vs(){return[this.x,this.y]}get mul_inverse(){return new O(1/this.x,1/this.y)}get inverse(){return new O(-this.x,-this.y)}get half(){return new O(this.x/2,this.y/2)}get length_squared(){return this.x*this.x+this.y*this.y}get length(){return Math.sqrt(this.length_squared)}get normalize(){return this.length===0?O.zero:this.scale(1/this.length)}get perpendicular(){return new O(-this.y,this.x)}get clone(){return new O(this.x,this.y)}get angle(){return Math.atan2(this.y,this.x)}get round(){return O.make(Math.round(this.x),Math.round(this.y))}get floor(){return O.make(Math.floor(this.x),Math.floor(this.y))}constructor(e,t){this.x=e,this.y=t}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}project_to(e){let t=e.length_squared,n=this.dot(e);return O.make(n*e.x/t,n*e.y/t)}distance(e){return this.sub(e).length}addy(e){return O.make(this.x,this.y+e)}add_angle(e){return O.from_angle(this.angle+e)}scale(e){let{clone:t}=this;return t.scale_in(e)}scale_in(e){return this.x*=e,this.y*=e,this}add(e){let{clone:t}=this;return t.add_in(e)}add_in(e){return this.x+=e.x,this.y+=e.y,this}sub(e){let{clone:t}=this;return t.sub_in(e)}sub_in(e){return this.x-=e.x,this.y-=e.y,this}mul(e){let{clone:t}=this;return t.mul_in(e)}mul_in(e){return this.x*=e.x,this.y*=e.y,this}div(e){let{clone:t}=this;return t.div_in(e)}div_in(e){return this.x/=e.x,this.y/=e.y,this}set_in(e,t=this.y){return this.x=e,this.y=t,this}};let $=O;re($,"from_angle",e=>new O(Math.cos(e),Math.sin(e))),re($,"make",(e,t)=>new O(e,t));const ae=class{constructor(e,t,n,r,s,l){re(this,"array_t"),this.a=e,this.b=t,this.c=n,this.d=r,this.tx=s,this.ty=l,this.array_t=new Float32Array([e,t,0,n,r,0,s,l,1])}static get identity(){return new ae(1,0,0,1,0,0)}static get unit(){return ae.identity}get clone(){let{a:e,b:t,c:n,d:r,tx:s,ty:l}=this;return new ae(e,t,n,r,s,l)}get inverse(){let{a:e,b:t,c:n,d:r,tx:s,ty:l}=this,o=e*r-t*n,i=r/o,a=-t/o,u=-n/o,c=e/o,f=(n*l-r*s)/o,h=-(e*l-t*s)/o;return new ae(i,a,u,c,f,h)}rotate_in(e){let t=Math.cos(e),n=Math.sin(e),r=this.a*t-this.b*n,s=this.a*n+this.b*t,l=this.c*t-this.d*n,o=this.c*n+this.d*t,i=this.tx*t-this.ty*n,a=this.tx*n+this.ty*t;this.a=r,this.b=s,this.c=l,this.d=o,this.tx=i,this.ty=a}rotate(e){let{clone:t}=this;return t.rotate_in(e),t}scale(e,t){let n=this.a*e,r=this.b,s=this.c,l=this.d*t,o=this.tx,i=this.ty;return new ae(n,r,s,l,o,i)}translate_in(e,t){this.a,this.b,this.c,this.d;let n=e+this.tx,r=t+this.ty;return this.tx=n,this.ty=r,this}translate(e,t){let{clone:n}=this;return n.translate_in(e,t),n}scale_in(e,t){return this.a=e,this.d=t,this}mVec2(e){let t=this.a,n=this.b,r=this.c,s=this.d,l=this.tx,o=this.ty,i=t*e.x+r*e.y+l,a=n*e.x+s*e.y+o;return $.make(i,a)}mul_in(e){let{a:t,b:n,c:r,d:s,tx:l,ty:o}=this;this.a=e.a*t+e.b*r,this.b=e.a*n+e.b*s,this.c=e.c*t+e.d*r,this.d=e.c*n+e.d*s,this.tx=e.tx*t+e.ty*r+l,this.ty=e.tx*n+e.ty*s+o}set_in(e){let{a:t,b:n,c:r,d:s,tx:l,ty:o}=e;this.a=t,this.b=n,this.c=r,this.d=s,this.tx=l,this.ty=o}transform_in(e,t,n,r=$.half){this.a=Math.cos(t)*e.x,this.b=Math.sin(t)*e.x,this.c=-Math.sin(t)*e.y,this.d=Math.cos(t)*e.y,this.tx=n.x-(r.x*this.a+r.y*this.c),this.ty=n.y-(r.x*this.b+r.y*this.d)}};let Ss=ae;re(Ss,"projection",(e,t)=>{let n=0,r=0,s=1/e*2,l=-1/t*2,o=-1,i=1;return new ae(s,n,r,l,o,i)});const st=class{static get unit(){return st.make(0,0,1)}scale(e){return st.make(this.o.x,this.o.y,this.r*e)}copy_in(e){return this.r=e.r,this.o=e.o,this}add_o_in(e){return this.o.add_in(e),this}constructor(e,t){this.o=e,this.r=t}};let Cs=st;re(Cs,"make",(e,t,n)=>new st($.make(e,t),n));const sr=class{constructor(e,t){this.a=e,this.b=t}get center(){return this.b.add(this.a).half}get parallel(){return this.b.sub(this.a).normalize}get normal(){return this.parallel.perpendicular}get angle(){return this.b.sub(this.a).angle}get radius(){return this.length/2}get length(){return this.b.sub(this.a).length}segments(e,t){return e.map((n,r)=>this.a.add(this.normal.scale(t[r]).add(this.parallel.scale(this.length*n))))}};let Ns=sr;re(Ns,"make",(e,t,n,r)=>new sr($.make(e,t),$.make(n,r)));const qe=class{constructor(e){this.vertices=e}static get unit(){return qe.make(0,0,1,1)}get vs(){let{x:e,y:t,w:n,h:r}=this;return[e,t,n,r]}get x1(){return this.vertices[0].x}get y1(){return this.vertices[0].y}get x2(){return this.vertices[2].x}get y2(){return this.vertices[2].y}get x(){return this.x1}get y(){return this.y1}get w(){return this.x2-this.x1}get h(){return this.y2-this.y1}get center(){return $.make(this.x+this.w/2,this.y+this.h/2)}get vertexData(){return new Float32Array(this.vertices.flatMap(e=>e.vs))}get indices(){return new Uint16Array([0,1,2,0,2,3])}larger(e){return qe.make(this.x-e,this.y-e,this.w+e,this.h+e)}transform(e){return new qe(this.vertices.map(t=>e.mVec2(t)))}};let Ms=qe;re(Ms,"make",(e,t,n,r)=>new qe([$.make(e,t),$.make(e+n,t),$.make(e+n,t+r),$.make(e,t+r)]));function js(e){let t=new Map;function n(r,s,l=!1){let o=t.get(r);if(!l&&o&&o.length>0)return o.sort((i,a)=>a.distance(s)-i.distance(s)),o.pop();{let i=e.pop();return i.x=s.x,i.y=s.y,i}}return{reset_fix_all(){for(let r of t.values())r.forEach(s=>e.push(s));t=new Map},acquire_pos:n,release_pos(r,s){let l=t.get(r);l||(l=[],t.set(r,l)),l.push(s)}}}function _n(){let e=gn(),t=gn(void 0,{equals:!1}),n=Be(()=>{var o;return k(t),(o=k(e))==null?void 0:o.scrollTop});Be(()=>{let o=k(n);if(o!==void 0)return $.make(0,o)});let r=Be(()=>{var o;return k(t),(o=k(e))==null?void 0:o.getBoundingClientRect()}),s=Be(()=>{let o=r();if(o)return $.make(o.x,o.y)}),l=Be(()=>{let o=r();if(o)return $.make(o.width,o.height)});return{$clear_bounds(){N(t)},get $ref(){return k(e)},set $ref(o){N(e,o)},get rect(){return r()},get orig(){return s()},get size(){return l()},get_normal_at_abs_pos(o){let i=l(),a=s();if(!!i&&!!a)return o.sub(a).div(i)}}}function Ts(e){var t;if(e.clientX!==void 0&&e.clientY!==void 0)return[e.clientX,e.clientY];if((t=e.targetTouches)!=null&&t[0])return[e.targetTouches[0].clientX,e.targetTouches[0].clientY]}class ir{}re(ir,"init",(e,t=document)=>{const n=d=>$.make(...Ts(d)||$.zero);let{_onDragStart:r,_onDragMove:s,_onDragEnd:l,_onContextMenu:o,_onWheel:i}=e;const a=d=>{r==null||r(n(d),d.buttons===2||d.button===2)},u=d=>{s==null||s(n(d))},c=d=>{l==null||l(n(d))},f=d=>{o&&(d.preventDefault(),o())},h=d=>{i==null||i(Math.sign(ev.deltaY))};return t.addEventListener("wheel",h),t.addEventListener("touchstart",a,{passive:!1}),t.addEventListener("mousedown",a,{passive:!1}),t.addEventListener("contextmenu",f),document.addEventListener("mousemove",u),document.addEventListener("mouseup",c),document.addEventListener("touchmove",u),document.addEventListener("touchend",c),()=>{t.removeEventListener("wheel",h),t.removeEventListener("touchstart",a),t.removeEventListener("mousedown",a),t.removeEventListener("contextmenu",f),document.removeEventListener("mousemove",u),document.removeEventListener("mouseup",c),document.removeEventListener("touchmove",u),document.removeEventListener("touchend",c)}});const vn=(e,t)=>{ys(bs(()=>t.$ref,n=>{n&&Xn(Bs(e,n))}))},Bs=(e,t)=>{let{on_hover:n,on_up:r,on_click:s,on_drag:l,on_context:o}=e,i,a,u,c;const f=h=>h&&{...h};return ir.init({...o?{_onContextMenu(){o()}}:{},_onDragStart(h,d){a=f(i),i={e:h,_right:d},c&&(c==null||c()),c=rr((p,g)=>{(i.m||i.e.distance(u)>3)&&(i.m=u),l==null||l(i,a),a=f(i)})},_onDragMove(h){u=h,i||n==null||n(h)},_onDragEnd(){!i||(i.m||s==null||s(i.e,i._right),r==null||r(i.m||i.e,i._right),c==null||c(),c=void 0,i=void 0)}},t)};function mn(e,t,n,r){return e.addEventListener(t,n,r),()=>e.removeEventListener(t,n,r)}const Os=e=>{let t=[];t.push(mn(document,"scroll",()=>e.onScroll(),{capture:!0,passive:!0})),t.push(mn(window,"resize",()=>e.onScroll(),{passive:!0})),Xn(()=>t.forEach(n=>n()))},yn=e=>t=>setTimeout(()=>e.$ref=t);function it(e,t,n=.5){return e*(1-n)+t*n}function bn(e){return e<.5?2*e*e:-1+(4-2*e)*e}const te=1e3/60,lr={seconds:60*te,half:30*te,thirds:20*te,lengths:15*te,sixth:10*te,five:5*te,three:3*te,one:1*te},Ls="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1",en="abcdefgh".split(""),Ue="87654321".split(""),qs=Ue.slice(0).reverse(),or="wb".split(""),Rt="rkqbnp".split(""),tn={r:"rook",k:"king",q:"queen",b:"bishop",n:"knight",p:"pawn"},vt={w:"white",b:"black"},Ps=vt;or.flatMap(e=>Rt.map(t=>e+t));const mt=en.flatMap(e=>Ue.map(t=>e+t)),ye=e=>{let t=en[e.x],n=Ue[e.y];return t&&n&&t+n},Ae=new Map(mt.map(e=>{let[t,n]=e.split(""),r=en.indexOf(t),s=Ue.indexOf(n);return[e,$.make(r,s)]})),ar=e=>{let t=Ae.get(e);return(t.x+t.y)%2===0},Rs=e=>!ar(e);mt.filter(ar);mt.filter(Rs);const ur=(e,t)=>t==="b"?$.make(e.x,7-e.y):e;function Us(e,t,n){let r=n.length,s=t.length,l=r,o=0,i=0,a=t[s-1].nextSibling,u=null;for(;o<s||i<l;){if(t[o]===n[i]){o++,i++;continue}for(;t[s-1]===n[l-1];)s--,l--;if(s===o){const c=l<r?i?n[i-1].nextSibling:n[l-i]:a;for(;i<l;)e.insertBefore(n[i++],c)}else if(l===i)for(;o<s;)(!u||!u.has(t[o]))&&t[o].remove(),o++;else if(t[o]===n[l-1]&&n[i]===t[s-1]){const c=t[--s].nextSibling;e.insertBefore(n[i++],t[o++].nextSibling),e.insertBefore(n[--l],c),t[s]=n[l]}else{if(!u){u=new Map;let f=i;for(;f<l;)u.set(n[f],f++)}const c=u.get(t[o]);if(c!=null)if(i<c&&c<l){let f=o,h=1,d;for(;++f<s&&f<l&&!((d=u.get(t[f]))==null||d!==c+h);)h++;if(h>c-i){const p=t[o];for(;i<c;)e.insertBefore(n[i++],p)}else e.replaceChild(n[i++],t[o++])}else o++;else t[o++].remove()}}}const wn="_$DX_DELEGATE";function nn(e,t,n){const r=document.createElement("template");r.innerHTML=e;let s=r.content.firstChild;return n&&(s=s.firstChild),s}function Ds(e,t=window.document){const n=t[wn]||(t[wn]=new Set);for(let r=0,s=e.length;r<s;r++){const l=e[r];n.has(l)||(n.add(l),t.addEventListener(l,Fs))}}function Is(e,t){t==null?e.removeAttribute("class"):e.className=t}function xn(e,t,n){return V(()=>e(t,n))}function ue(e,t,n,r){if(n!==void 0&&!r&&(r=[]),typeof t!="function")return lt(e,t,r,n);j(s=>lt(e,t(),s,n),r)}function Fs(e){const t=`$$${e.type}`;let n=e.composedPath&&e.composedPath()[0]||e.target;for(e.target!==n&&Object.defineProperty(e,"target",{configurable:!0,value:n}),Object.defineProperty(e,"currentTarget",{configurable:!0,get(){return n||document}}),b.registry&&!b.done&&(b.done=!0,document.querySelectorAll("[id^=pl-]").forEach(r=>r.remove()));n!==null;){const r=n[t];if(r&&!n.disabled){const s=n[`${t}Data`];if(s!==void 0?r.call(n,s,e):r.call(n,e),e.cancelBubble)return}n=n.host&&n.host!==n&&n.host instanceof Node?n.host:n.parentNode}}function lt(e,t,n,r,s){for(b.context&&!n&&(n=[...e.childNodes]);typeof n=="function";)n=n();if(t===n)return n;const l=typeof t,o=r!==void 0;if(e=o&&n[0]&&n[0].parentNode||e,l==="string"||l==="number"){if(b.context)return n;if(l==="number"&&(t=t.toString()),o){let i=n[0];i&&i.nodeType===3?i.data=t:i=document.createTextNode(t),n=be(e,n,r,i)}else n!==""&&typeof n=="string"?n=e.firstChild.data=t:n=e.textContent=t}else if(t==null||l==="boolean"){if(b.context)return n;n=be(e,n,r)}else{if(l==="function")return j(()=>{let i=t();for(;typeof i=="function";)i=i();n=lt(e,i,n,r)}),()=>n;if(Array.isArray(t)){const i=[],a=n&&Array.isArray(n);if(Ut(i,t,n,s))return j(()=>n=lt(e,i,n,r,!0)),()=>n;if(b.context){if(!i.length)return n;for(let u=0;u<i.length;u++)if(i[u].parentNode)return n=i}if(i.length===0){if(n=be(e,n,r),o)return n}else a?n.length===0?$n(e,i,r):Us(e,n,i):(n&&be(e),$n(e,i));n=i}else if(t instanceof Node){if(b.context&&t.parentNode)return n=o?[t]:t;if(Array.isArray(n)){if(o)return n=be(e,n,r,t);be(e,n,null,t)}else n==null||n===""||!e.firstChild?e.appendChild(t):e.replaceChild(t,e.firstChild);n=t}}return n}function Ut(e,t,n,r){let s=!1;for(let l=0,o=t.length;l<o;l++){let i=t[l],a=n&&n[l];if(i instanceof Node)e.push(i);else if(!(i==null||i===!0||i===!1))if(Array.isArray(i))s=Ut(e,i,a)||s;else if(typeof i=="function")if(r){for(;typeof i=="function";)i=i();s=Ut(e,Array.isArray(i)?i:[i],Array.isArray(a)?a:[a])||s}else e.push(i),s=!0;else{const u=String(i);a&&a.nodeType===3&&a.data===u?e.push(a):e.push(document.createTextNode(u))}}return s}function $n(e,t,n){for(let r=0,s=t.length;r<s;r++)e.insertBefore(t[r],n)}function be(e,t,n,r){if(n===void 0)return e.textContent="";const s=r||document.createTextNode("");if(t.length){let l=!1;for(let o=t.length-1;o>=0;o--){const i=t[o];if(s!==i){const a=i.parentNode===e;!l&&!o?a?e.replaceChild(s,i):e.insertBefore(s,n):a&&i.remove()}else l=!0}}else e.insertBefore(s,n);return[s]}var z=["a","b","c","d","e","f","g","h"],se=["1","2","3","4","5","6","7","8"],Ks=["w","b"],Dt=["r","q","b","n","p","k"],Vs=["q","n","r","b"],T=z.flatMap(e=>se.map(t=>e+t)),zs=Ks.flatMap(e=>Dt.map(t=>e+t));zs.flatMap(e=>T.map(t=>[e,t].join("@")));var Hs=se.slice(0).reverse();se.flatMap(e=>z.map(t=>t+e));var Ys=Hs.flatMap(e=>z.map(t=>t+e));T.flatMap(e=>T.map(t=>e+t));var Xs=e=>e[0]==="w"?e[1].toUpperCase():e[1],yt={a:"b",b:"c",c:"d",d:"e",e:"f",f:"g",g:"h"},bt={h:"g",g:"f",f:"e",e:"d",d:"c",c:"b",b:"a"},wt={1:"2",2:"3",3:"4",4:"5",5:"6",6:"7",7:"8"},xt={8:"7",7:"6",6:"5",5:"4",4:"3",3:"2",2:"1"};function $t(e,t){let n={};return e.forEach(r=>{let s=t[r];s&&(s=t[s],s&&(n[r]=s))}),n}var cr=$t(z,yt),fr=$t(z,bt),hr=$t(se,wt),dr=$t(se,xt);function kt(e,t){let n={};return e.forEach(r=>{let s={},l=r,o=[];for(;l=t[l];)s[l]=o.slice(0),o.push(l);n[r]=s}),n}var rn=kt(z,yt),sn=kt(z,bt),ln=kt(se,wt),on=kt(se,xt);function pr(e){let t={};return T.forEach(n=>{let[r,s]=n.split(""),l={},o=e[r];Object.keys(o).map(i=>{let a=o[i].map(u=>u+s);l[i+s]=a}),t[n]=l}),t}var gr=pr(rn),_r=pr(sn);function vr(e){let t={};return T.forEach(n=>{let[r,s]=n.split(""),l={},o=e[s];Object.keys(o).map(i=>{let a=o[i].map(u=>r+u);l[r+i]=a}),t[n]=l}),t}var an=vr(ln),un=vr(on);function Gs(e,t){return e.map((n,r)=>n+t[r])}function At(e,t){let n={};return T.forEach(r=>{let[s,l]=r.split(""),o={},i=e[l],a=t[s];Object.keys(i).map(u=>{let c=Object.keys(a).find(f=>a[f].length===i[u].length);if(c){let f=Gs(a[c],i[u]);o[c+u]=f}}),n[r]=o}),n}var mr=At(ln,sn),yr=At(ln,rn),br=At(on,sn),wr=At(on,rn);function ie(e,t){let n={};return T.forEach(r=>{let[s,l]=r.split("");T.forEach(o=>{let[i,a]=o.split("");t[s]===i&&e[l]===a&&(n[r]=o)})}),n}var Qs=ie(hr,bt),Ws=ie(hr,yt),Zs=ie(wt,fr),Js=ie(wt,cr),ei=ie(dr,bt),ti=ie(dr,yt),ni=ie(xt,fr),ri=ie(xt,cr);function xr(e,t){let n={};return T.forEach(r=>{let s=Object.keys(e[r]).find(l=>e[r][l].length===t);s&&(n[r]={[s]:e[r][s]})}),n}var $r=e=>xr(e,1),le=e=>xr(e,0),si=$r(an),ii=$r(un),kr=le(an),Ar=le(un),Er=le(mr),Sr=le(yr),Cr=le(br),Nr=le(wr),li=le(gr),oi=le(_r);function ai(e){let t={};return T.forEach(n=>{let r=[];T.forEach(s=>{e.map(l=>l[n]===s).find(Boolean)&&r.push(s)}),r.length>0&&(t[n]=r)}),t}var ui=ai([Qs,Ws,ei,ti,Zs,Js,ni,ri]);function H(e){let t={};return T.forEach(n=>{let r={};T.forEach(s=>{e.forEach(l=>{var o;(o=l[n])!=null&&o[s]&&(r[s]=l[n][s])})}),t[n]=r}),t}var ci=H([kr,Er,Sr]),fi=H([Ar,Cr,Nr]),hi=H([oi,li]),Mr=H([mr,yr,br,wr]),jr=H([an,un,_r,gr]),di=H([ci,fi,hi]),pi=H([Mr,jr]),gi=e=>e.split("")[1]==="2",_i=e=>e.split("")[1]==="7",Tr=e=>e.split("")[1]!=="1",Br=e=>e.split("")[1]!=="8";function Ne(e,t){let n={};return T.forEach(r=>{t(r)&&e[r]&&(n[r]=e[r])}),n}var vi=Ne(si,gi),mi=Ne(ii,_i),yi=Ne(kr,Tr),bi=Ne(Ar,Br),wi=H([vi,yi]),xi=H([mi,bi]),$i=Ne(H([Sr,Er]),Tr),ki=Ne(H([Nr,Cr]),Br),Ai={q:z,k:z.slice(0).reverse()},Pe=class{constructor(e){this._pieses=e}static get empty(){return new Pe(new Map)}get fen(){return Ys.reduce(([e,t,n,r],s)=>{let l=this._pieses.get(s);return l?(e+=(r||"")+Xs(l.split("@")[0]),r=void 0):r=(r||0)+1,n===8?(t--,n=1,e+=(r||"")+(t>0?"/":""),r=void 0):n++,[e,t,n,r]},["",8,1])[0]}get pieses(){return[...this._pieses].map(e=>e.reverse().join("@"))}in(e){let[t,n]=e.split("@");return this.in_piece(t,n)}in_piece(e,t){return this._pieses.set(t,e),this}out(e){return this._pieses.delete(e),this}on(e){return this._pieses.get(e)}rook_file_at_side(e,t){return Ai[t].find(n=>{var r;let s=n+e;if(((r=this._pieses.get(s))==null?void 0:r[1])==="r")return!0})}get poss(){return[...this._pieses.keys()]}get clone(){return new Pe(new Map(this._pieses))}},De=Pe;De.from_fen=e=>{let t=e.split("/").flatMap((n,r)=>{let s=[],l=0;return n.split("").forEach(o=>{let i=Dt.indexOf(o.toLowerCase());if(i>-1){let a=Dt[i],u=(o.toLowerCase()===o?"b":"w")+a,c=z[l]+se[7-r];s.push([c,u]),l++}else l+=parseInt(o)}),s});return new Pe(new Map(t))};De.from_pieses=e=>new Pe(new Map(e.map(t=>{let[n,r]=t.split("@");return[r,n]})));var Or=(e,t)=>{let n={};return e.forEach(r=>{let s=t(r);s&&(n[s[0]]=s[1])}),n},ge=(e,t)=>{let n={};return e.forEach(r=>{let s=t(r);s&&(n[r]=s)}),n},G=(e,t)=>{let n={};return Object.keys(e).forEach(r=>{let s=t(r,e[r]);s&&(n[r]=s)}),n},Ei=class{constructor(e,t){this._board=e,this._castles=t}capture_ray(e){var t;let n=this._board.on(e);if(n){let[r,s]=n.split(""),l=(t=ot[s])==null?void 0:t[e];if(l)return Array.isArray(l)?ge(l,o=>this.capture(e,o)):G(l,(o,i)=>{if(i&&!i.find(a=>this._board.on(a)))return this.capture(e,o)})}}capture_pawn(e){let t=this._board.on(e);if(t){let[n,r]=t.split("@"),[s,l]=n.split("");if(l==="p"){let o=qr[s][e];return G(o,(i,a)=>this.capture(e,i))}}}mobile_pawn(e){let t=this._board.on(e);if(t){let[n,r]=t.split("@"),[s,l]=n.split("");if(l==="p"){let o=Lr[s][e];return G(o,(i,a)=>{if(a&&!a.find(u=>this._board.on(u)))return this.mobile(e,i)})}}}mobile_ray(e){var t;let n=this._board.on(e);if(n){let[r,s]=n.split(""),l=(t=ot[s])==null?void 0:t[e];if(l)return Array.isArray(l)?ge(l,o=>this.mobile(e,o)):G(l,(o,i)=>{if(!i.find(a=>this.board.on(a)))return this.mobile(e,o)})}}capture(e,t){let{board:n}=this,r=n.on(e),s=n.on(t);if(e!==t&&!!r&&!!s){let[l]=s.split("@"),[o]=l.split(""),[i]=r.split("@"),[a]=i.split("");if(a!==o)return n.out(e),n.out(t),n.in_piece(r,t),[n,r,s]}}mobile(e,t){let{board:n}=this,r=n.on(e),s=n.on(t);if(e!==t&&!!r&&!s)return n.out(e),n.in_piece(r,t),[n,r]}castle(e){return Or(["k","q"],t=>{let n=this._board.on(e);if(n){let[r,s]=n.split("");if(s==="k"){let l=r==="w"?t.toUpperCase():t;if(!this.castles[l])return;let o=Pr[r];e.split("");let[i,a]=Rr[t],u=this._board.rook_file_at_side(r,t),c=i+o,f=e,h=u+o,d=c,p=a+o,{board:g}=this;return g.out(f),g.out(h),g.in_piece(r+"k",d),g.in_piece(r+"r",p),[d,[g,t]]}}})}get castles(){let e={};return this._castles.split("").forEach(t=>e[t]=!0),e}get board(){return this._board.clone}},ot={b:Mr,q:pi,r:jr,n:ui,k:di},Lr={w:wi,b:xi},qr={w:$i,b:ki},Pr={w:1,b:8},Rr={k:["g","f"],q:["c","d"]};function Ur(e){let t={};return e.forEach(n=>Object.keys(n).forEach(r=>{t[r]=n[r]})),t}var at=class{constructor(e,t,n){this.turn=e,this._board=t,this._castles=n,this.rays=new Ei(t,n)}mobile_situation(e){let t=this.board.on(e);if(!t)return;let[n,r]=t;if(n!==this.turn)return;let s=Ur([this.rays.mobile_ray(e),this.rays.mobile_pawn(e),this.rays.capture_ray(e),this.rays.capture_pawn(e),this.rays.castle(e)].filter(Boolean));if(Object.keys(s).length>0)return G(s,(l,o)=>{let[i]=o;return o[0]=this.opposite(i),o})}opposite(e){let t=this.turn==="w"?"b":"w";return new at(t,e,this._castles)}same(e){return new at(this.turn,e,this._castles)}with_board(e){return this.same(e(this.board))}get allowed_mobiles(){return this._c_mobiles||(this._c_mobiles=ge(this.board.poss,e=>this.mobile_situation(e))),this._c_mobiles}get ods(){return Object.keys(this.allowed_mobiles).flatMap(e=>Object.keys(this.allowed_mobiles[e]).map(t=>e+t))}od(e){let[t,n]=[e.slice(0,2),e.slice(2)];return this.allowed_mobiles[t][n]}o_ds(e){return this.ods.filter(t=>t.slice(0,2)===e)}get board(){return this._board.clone}get fen(){return[this._board.fen,this.turn,this._castles].join(" ")}},Ee=at;Ee.from_fen=e=>{let[t,n,r]=e.split(" "),s=De.from_fen(t);return new at(n,s,r)};function Si(e){return`{${[e.uci,e.comment].join(" ")}}`}function Dr(e,t){return t?Object.keys(t).flatMap(n=>{if(n==="data")return[e,Si(t[n])].join("___");let r=e+n;return Dr(r,t[n])}):[]}function Oe(e,t){if(t==="")return e;let[n,r]=[t.slice(0,2),t.slice(2)];return Oe(e[n],r)}function Ir(e,t,n){if(t==="")return[...n,e];let[r,s]=[t.slice(0,2),t.slice(2)];return Ir(e[r],s,[...n,e])}var Fr=class{constructor(e,t){this.situation=e,this._moves=t}follow_path(e){return Ir(this._moves,e,[])}path(e){return Oe(this._moves,e)}remove(e){let[t,n]=[e.slice(0,-2),e.slice(-2)],r=Oe(this._moves,e);delete r[Fe(n)]}move(e,t,n={}){var r;let s=Oe(this._moves,e);s[r=Fe(t)]||(s[r]={}),s[Fe(t)].data={uci:t,...n}}data(e,t){let n=Oe(this._moves,e);return t&&(n.data=t),n.data}play_ucis(e){e.split(" ").reduce((t,n)=>{let r=Fe(n);return this.move(t,n),t+r},"")}get replay(){return[this.situation.fen,Dr("",this._moves).join(`
`)].join(`

`)}get moves(){}},It=Fr;It.from_fen=e=>new Fr(Ee.from_fen(e),{});var Kr=35,Vr=String.fromCharCode(33),Ci=e=>T.indexOf(e)+1,zr=ge(T,e=>String.fromCharCode(Ci(e)+Kr)),Mt=e=>zr[e]||Vr,Ni=(()=>{let e={};return Vs.map((t,n)=>{z.map((r,s)=>{let l=t+r,o=String.fromCharCode(Kr+Object.keys(zr).length+n*8+s-1);e[l]=o})}),e})(),Mi=(e,t)=>Ni[t+e]||Vr,Fe=e=>{let[t,n]=e.split("="),[r,s]=[t.slice(0,2),t.slice(2)];return n?Mt(r)+Mi(s[0],n):Mt(r)+Mt(s)},ji=e=>Object.keys(e).every(t=>Object.keys(e).every(n=>t===n||e[t][0]!==e[n][0]));function Ti(e,t,n){let{turn:r}=t,s=r==="w"?"b":"w",l=[...new Set(n.flat())],o={};l.forEach(a=>{let u=a[0],c=(u.toUpperCase()===u?s:r)+u.toLowerCase();u==="f"?o[a]=T:o[a]=T.filter(f=>t.board.on(f)===c)});function i(a,u={}){let c=a.slice(0);if(c.length===0)return u;let f=c.pop(),[h,d]=f;u[h]||(u[h]=o[h].slice(0)),u[d]||(u[d]=o[d].slice(0));let p;return f.length===3&&([,,p]=f,u[p]||(u[p]=o[p].slice(0))),u[h].flatMap(g=>{let m=u[d].filter(y=>e.o_ds(g).includes(g+y));return p?m.flatMap(y=>{let[S]=e.od(g+y);return u[p].filter(v=>S.o_ds(y).includes(y+v)).map(v=>({...u,[h]:[g],[d]:[y],[p]:[v]}))}):m.map(y=>({...u,[h]:[g],[d]:[y]}))}).flatMap(g=>i(c,g)).filter(g=>ji(g))}return i(n)}var Bi=class{constructor(e,t){this._board=e,this._castles=t}capture_ray(e){var t;let n=this._board.on(e);if(n){let[r,s]=n.split(""),l=(t=ot[s])==null?void 0:t[e];if(l)return Array.isArray(l)?ge(l,o=>this.capture(e,o)):G(l,(o,i)=>{if(i&&!i.find(a=>this._board.on(a)))return this.capture(e,o)})}}capture_pawn(e){let t=this._board.on(e);if(t){let[n,r]=t.split("@"),[s,l]=n.split("");if(l==="p"){let o=qr[s][e];return G(o,(i,a)=>this.capture(e,i))}}}mobile_pawn(e){let t=this._board.on(e);if(t){let[n,r]=t.split("@"),[s,l]=n.split("");if(l==="p"){let o=Lr[s][e];return G(o,(i,a)=>{if(a&&!a.find(u=>this._board.on(u)))return this.mobile(e,i)})}}}mobile_ray(e){var t;let n=this._board.on(e);if(n){let[r,s]=n.split(""),l=(t=ot[s])==null?void 0:t[e];if(l)return Array.isArray(l)?ge(l,o=>this.mobile(e,o)):G(l,(o,i)=>{if(!i.find(a=>this.board.on(a)))return this.mobile(e,o)})}}capture(e,t){let{board:n}=this,r=n.on(e),s=n.on(t);if(e!==t&&!!r&&!!s){let[l]=s.split("@");l.split("");let[o]=r.split("@");return o.split(""),n.out(e),n.out(t),n.in_piece(r,t),[n,r,s]}}mobile(e,t){let{board:n}=this,r=n.on(e),s=n.on(t);if(e!==t&&!!r&&!s)return n.out(e),n.in_piece(r,t),[n,r]}castle(e){return Or(["k","q"],t=>{let n=this._board.on(e);if(n){let[r,s]=n.split("");if(s==="k"){let l=r==="w"?t.toUpperCase():t;if(!this.castles[l])return;let[o,i]=Rr[t],a=this._board.rook_file_at_side(r,t),u=Pr[r],c=o+u,f=e,h=a+u,d=c,p=i+u,{board:g}=this;return g.out(f),g.out(h),g.in_piece(r+"k",d),g.in_piece(r+"r",p),[d,[g,t]]}}})}get castles(){let e={};return this._castles.split("").forEach(t=>e[t]=!0),e}get board(){return this._board.clone}},ut=class{constructor(e,t,n){this.turn=e,this._board=t,this._castles=n,this.rays=new Bi(t,n)}mobile_situation(e){if(!this.board.on(e))return;let t=Ur([this.rays.mobile_ray(e),this.rays.mobile_pawn(e),this.rays.capture_ray(e),this.rays.capture_pawn(e),this.rays.castle(e,"k"),this.rays.castle(e,"q")].filter(Boolean));if(Object.keys(t).length>0)return G(t,(n,r)=>{let[s]=r;return r[0]=this.opposite(s),r})}opposite(e){let t=this.turn==="w"?"b":"w";return new ut(t,e,this._castles)}same(e){return new ut(this.turn,e,this._castles)}with_board(e){return this.same(e(this.board))}get allowed_mobiles(){return this._c_mobiles||(this._c_mobiles=ge(this.board.poss,e=>this.mobile_situation(e))),this._c_mobiles}get ods(){return Object.keys(this.allowed_mobiles).flatMap(e=>Object.keys(this.allowed_mobiles[e]).map(t=>e+t))}od(e){let[t,n]=[e.slice(0,2),e.slice(2)];return this.allowed_mobiles[t][n]}o_ds(e){return this.ods.filter(t=>t.slice(0,2)===e)}get board(){return this._board.clone}get fen(){return[this._board.fen,this.turn].join(" ")}},Hr=ut;Hr.from_fen=e=>{let[t,n,r]=e.split(" "),s=De.from_fen(t);return new ut(n,s,r)};const Oi={id:"00Ec4",fen:"2rq1r1k/p5pp/8/1p1BpPb1/2Pp2Q1/P2P2R1/6PP/R5K1 b - - 3 25",moves:"c8c7 g4g5 d8g5 g3g5",tags:"crushing middlegame short",link:"https://lichess.org/HUFGdjKK/black#50"},Li=()=>fetch("data/athousand_sorted.csv").then(e=>e.text()).then(e=>e.split(`
`).map(t=>{let[n,r,s,,,,,l,o]=t.split(",");return{id:n,fen:r,moves:s,tags:l,link:o}})),Yr=(e,t)=>{let{fen:n,moves:r}=t,[s,...l]=r.split(" ");return Xr(e,Ee.from_fen(n).od(s)[0].fen)},Xr=(e,t)=>{let n=Ee.from_fen(t),r=Hr.from_fen(n.fen);return Ti(r,n,e)},qi=(e,t,n)=>{let r=Xr(e,n)[0];return r?t.map(s=>s.map(l=>{let[o,i]=l.split("-");return i||([o,i]=l.split("")),r[o]+r[i]}).join(" ")):[]};let ct=[["r","B"],["R","B"],["R","R2"],["q","R2","R"],["R","K"],["n","B","Q"],["n","B","K"],["P","B"]],Gr=[["rB","RB","q-R2"],["rB","PB","nB","RB","q-R2"]];ct=[["q","f0","K"]];Gr=[["q-f0"]];function Ft(e,t){let n=t.shift();return n?Ft(e.od(n)[0],t):e}const kn=e=>{let[t,n]=e.split(`

`);return n===""?[]:n.split(`
`).map(r=>{let[s,l]=r.split("___"),[,o]=l.match(/\{(.*)\}/),[i]=o.split(" ");return[s,i].join(" ")})};class Pi{get board_fen(){return this.m_analysis.board_fen}get replay_fen(){return this.m_analysis.replay_fen}get replay_fen2(){return this.m_analysis.replay_fen2}onScroll(){}on_hover(t,n){this.m_analysis.on_hover(t,n)}constructor(){let t=cs(Li);this.m_puzzles=_(()=>{let n=k(t);return n==null||n.reverse(),n==null?void 0:n.slice(25,200).filter(r=>Yr(ct,r).length>0)}),this.m_analysis=Ri(this)}}const Ri=e=>{let t=M(0),n=_(()=>{var v;return(v=e.m_puzzles())==null?void 0:v.length}),r=_(()=>`${k(t)+1}/${n()}`),s=_(()=>{var v;return((v=e.m_puzzles())==null?void 0:v[k(t)])||Oi});_(()=>Yr(ct,s()));let l=M("w"),o=_(()=>s().fen),i=_(()=>s().moves),a=_(()=>{let v=o(),A=i(),[x]=A.split(" "),Q=Ft(Ee.from_fen(v),[x]).fen;return qi(ct,Gr,Q).map(oe=>[x,oe].join(" "))}),u=_(()=>{let v=o(),A=a(),x=It.from_fen(v);return A.forEach(Q=>x.play_ucis(Q)),x}),c=M([]),f=_(()=>Ft(Ee.from_fen(o()),k(c))),h=_(()=>f().board),d=_(()=>k(l)||f().turn),p=_(()=>h().pieses),g=_(()=>[d(),...p()].join(" ")),m=_(()=>{let v=o(),A=i(),x=It.from_fen(v);return x.play_ucis(A),x}),y=_(()=>kn(m().replay)),S=_(()=>kn(u().replay));return{on_hover(v,A){let x=A?u():m();if(x&&v){let Q=x.follow_path(v).slice(1).map(oe=>oe.data.uci);N(c,Q)}},set i(v){N(c,[]);let A=n();N(t,x=>(x+v+A)%A)},get text(){return r()},get board_fen(){return g()},get replay_fen(){return y()},get replay_fen2(){return S()}}};var Ui=Object.defineProperty,Di=(e,t,n)=>t in e?Ui(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,Ii=(e,t,n)=>(Di(e,typeof t!="symbol"?t+"":t,n),n);function Fi(e,t,n){let r=n.length,s=t.length,l=r,o=0,i=0,a=t[s-1].nextSibling,u=null;for(;o<s||i<l;){if(t[o]===n[i]){o++,i++;continue}for(;t[s-1]===n[l-1];)s--,l--;if(s===o){const c=l<r?i?n[i-1].nextSibling:n[l-i]:a;for(;i<l;)e.insertBefore(n[i++],c)}else if(l===i)for(;o<s;)(!u||!u.has(t[o]))&&t[o].remove(),o++;else if(t[o]===n[l-1]&&n[i]===t[s-1]){const c=t[--s].nextSibling;e.insertBefore(n[i++],t[o++].nextSibling),e.insertBefore(n[--l],c),t[s]=n[l]}else{if(!u){u=new Map;let f=i;for(;f<l;)u.set(n[f],f++)}const c=u.get(t[o]);if(c!=null)if(i<c&&c<l){let f=o,h=1,d;for(;++f<s&&f<l&&!((d=u.get(t[f]))==null||d!==c+h);)h++;if(h>c-i){const p=t[o];for(;i<c;)e.insertBefore(n[i++],p)}else e.replaceChild(n[i++],t[o++])}else o++;else t[o++].remove()}}}function ve(e,t,n){const r=document.createElement("template");r.innerHTML=e;let s=r.content.firstChild;return n&&(s=s.firstChild),s}function D(e,t,n){n==null?e.removeAttribute(t):e.setAttribute(t,n)}function Ke(e,t){t==null?e.removeAttribute("class"):e.className=t}function jt(e,t,n={}){const r=e.style,s=typeof n=="string";if(t==null&&s||typeof t=="string")return r.cssText=t;s&&(r.cssText=void 0,n={}),t||(t={});let l,o;for(o in n)t[o]==null&&r.removeProperty(o),delete n[o];for(o in t)l=t[o],l!==n[o]&&(r.setProperty(o,l),n[o]=l);return n}function Y(e,t,n,r){if(n!==void 0&&!r&&(r=[]),typeof t!="function")return ft(e,t,r,n);j(s=>ft(e,t(),s,n),r)}function ft(e,t,n,r,s){for(b.context&&!n&&(n=[...e.childNodes]);typeof n=="function";)n=n();if(t===n)return n;const l=typeof t,o=r!==void 0;if(e=o&&n[0]&&n[0].parentNode||e,l==="string"||l==="number"){if(b.context)return n;if(l==="number"&&(t=t.toString()),o){let i=n[0];i&&i.nodeType===3?i.data=t:i=document.createTextNode(t),n=we(e,n,r,i)}else n!==""&&typeof n=="string"?n=e.firstChild.data=t:n=e.textContent=t}else if(t==null||l==="boolean"){if(b.context)return n;n=we(e,n,r)}else{if(l==="function")return j(()=>{let i=t();for(;typeof i=="function";)i=i();n=ft(e,i,n,r)}),()=>n;if(Array.isArray(t)){const i=[],a=n&&Array.isArray(n);if(Kt(i,t,n,s))return j(()=>n=ft(e,i,n,r,!0)),()=>n;if(b.context){if(!i.length)return n;for(let u=0;u<i.length;u++)if(i[u].parentNode)return n=i}if(i.length===0){if(n=we(e,n,r),o)return n}else a?n.length===0?An(e,i,r):Fi(e,n,i):(n&&we(e),An(e,i));n=i}else if(t instanceof Node){if(b.context&&t.parentNode)return n=o?[t]:t;if(Array.isArray(n)){if(o)return n=we(e,n,r,t);we(e,n,null,t)}else n==null||n===""||!e.firstChild?e.appendChild(t):e.replaceChild(t,e.firstChild);n=t}}return n}function Kt(e,t,n,r){let s=!1;for(let l=0,o=t.length;l<o;l++){let i=t[l],a=n&&n[l];if(i instanceof Node)e.push(i);else if(!(i==null||i===!0||i===!1))if(Array.isArray(i))s=Kt(e,i,a)||s;else if(typeof i=="function")if(r){for(;typeof i=="function";)i=i();s=Kt(e,Array.isArray(i)?i:[i],Array.isArray(a)?a:[a])||s}else e.push(i),s=!0;else{const u=String(i);a&&a.nodeType===3&&a.data===u?e.push(a):e.push(document.createTextNode(u))}}return s}function An(e,t,n){for(let r=0,s=t.length;r<s;r++)e.insertBefore(t[r],n)}function we(e,t,n,r){if(n===void 0)return e.textContent="";const s=r||document.createTextNode("");if(t.length){let l=!1;for(let o=t.length-1;o>=0;o--){const i=t[o];if(s!==i){const a=i.parentNode===e;!l&&!o?a?e.replaceChild(s,i):e.insertBefore(s,n):a&&i.remove()}else l=!0}}else e.insertBefore(s,n);return[s]}const cn=e=>({transform:`translate(calc(100% * ${e.x}), calc(100% * ${e.y}))`}),Ki=e=>$.make(...e.split(","));class Vi{set shapes(t){N(this._shapes,t)}set drag(t){this._drag_piese.piese=t}set fen(t){N(this._fen,t)}get squares(){return this.m_squares()}get pieses(){return this.m_pieses()}get ranks(){return this.m_ranks()}get orientation(){return this.m_orientation()}get circles(){return this.m_circles()}get arrows(){return this.m_arrows()}constructor(){this._drag_piese=Xi(),this._fen=M(Ls);let t=_(()=>{let u=k(this._fen),c=[,[],[],[]];return u.split(" ").forEach(f=>{if(f==="w"||f==="b"){c[0]=f;return}let[h,d]=f.split("@@");if(d){c[2].push(f);return}let[p,g]=f.split("@");if(mt.includes(g)){c[1].push(f);return}}),c}),n=_(()=>t()[0]),r=_(()=>t()[2]),s=_(()=>t()[1]),l=[...Array(64).keys()].map(u=>$.make(-8,-8));this._sticky_pos=js(l),this.m_orientation=n,this.m_pieses=_($e(()=>{let u=n();return s().map(c=>[u,c].join("__O__"))},u=>{let[c,f]=u.split("__O__"),[h,d]=f.split("@"),p=Ae.get(d),g=ur(p,c),m=this._sticky_pos.acquire_pos(h,g),y=Gi(this,f,m,g);return Re(()=>{this._sticky_pos.release_pos(h,y.pos)}),y})),this.m_squares=_($e(r,u=>Yi(this,u))),this.m_ranks=_(()=>n()==="w"?Ue:qs),he(Un(this.m_pieses,()=>{this._sticky_pos.reset_fix_all()})),this._shapes=M("");let o=_(()=>{let u=k(this._shapes),c=[[],[]];return u.split(" ").forEach(f=>{let[h,d]=f.split("@");h.match("circle")&&c[0].push(f),h.match("arrow")&&c[1].push(f)}),c}),i=_(()=>o()[0]);this.m_circles=_($e(i,u=>Hi(this,u)));let a=_(()=>o()[1]);this.m_arrows=_($e(a,u=>zi(this,u)))}}const Vt=e=>$.make(e.x-3.5,e.y-3.5),zi=(e,t)=>{let[n,r]=t.split("~"),s=r==="",[l,o]=n.split("@"),[i,a]=o.split(","),u=l.match("red")?"red":"green",[c,f]=Vt(Ae.get(i)).vs,[h,d]=Vt(Ae.get(a)).vs;return{id:u[0],x1:c,y1:f,x2:h,y2:d,stroke:u,drawing:s,get opacity(){return this.drawing?.9:1}}},Hi=(e,t)=>{let[n,r]=t.split("~"),s=r==="",[l,o]=n.split("@"),i=l.match("red")?"red":"green",[a,u]=Vt(Ae.get(o)).vs;return{cx:a,cy:u,stroke:i,drawing:s,get opacity(){return this.drawing?.9:1}}},Yi=(e,t)=>{let[n,r]=t.split("@@"),s=_(()=>ur(Ae.get(r),e.orientation)),l=["square",...n.split(",")].join(" ");return{get style(){return cn(s())},klass:l}},Xi=e=>{let t=M(),n=_(()=>{var o;return(o=k(t))==null?void 0:o.split("@")}),r=_(()=>{var o;let i=(o=n())==null?void 0:o[0];if(i)return["piese dragging",vt[i[0]],tn[i[1]]].join(" ")}),s=_(o=>{var i;return(o=(i=n())==null?void 0:i[1])&&Ki(o)}),l=M(s());return he(Un(s,o=>{o?Re(nr(lr.five,(i,a,u)=>{N(l,c=>$.make(it((c==null?void 0:c.x)||o.x,o.x,.5),it((c==null?void 0:c.y)||o.y,o.y,.5)))})):N(l,void 0)})),{set piese(o){N(t,o)},get klass(){return r()},get style(){let o=k(l);return o&&cn(o.sub($.make(.5,.5)))},get pos(){return k(l)}}},Gi=(e,t,n,r)=>{let[s]=t.split("@"),l=["piese",vt[s[0]],tn[s[1]]].join(" "),o=M(n.clone);return Re(nr(lr.half,(i,a,u)=>{N(o,()=>$.make(it(n.x,r.x,bn(u)),it(n.y,r.y,bn(u))))})),{klass:l,get style(){return cn(k(o))},get pos(){return k(o)}}},Qi=ve('<div><div class="squares"></div><div class="files"></div><div class="ranks"></div><div class="pieses"></div><svg class="shapes" viewBox="-4 -4 8 8" preserveAspectRatio="xMidYMid slice"><defs></defs><g></g></svg></div>'),Tt=ve("<div></div>"),Wi=ve('<div class="file"></div>'),Zi=ve('<div class="rank"></div>'),Ji=ve('<svg><marker orient="auto" markerWidth="4" markerHeight="8" refX="2.05" refY="2.01"><path d="M0,0 V4 L3,2 Z"></path></marker></svg>',6,!0),el=ve('<svg><circle fill="none" r="0.46875"></circle></svg>',4,!0),tl=ve('<svg><line stroke-width="0.15625" stroke-linecap="round"></line></svg>',4,!0);function Qr(e){let t=new Vi;return he(()=>{t.drag=e.drag}),he(()=>{t.fen=e.fen}),he(()=>{t.shapes=e.shapes||""}),(()=>{const n=Qi.cloneNode(!0),r=n.firstChild,s=r.nextSibling,l=s.nextSibling,o=l.nextSibling,i=o.nextSibling,a=i.firstChild,u=a.nextSibling;return Y(r,w(ne,{get each(){return t.squares},children:(c,f)=>(()=>{const h=Tt.cloneNode(!0);return j(d=>{const p=c.klass,g=c.style;return p!==d._v$&&Ke(h,d._v$=p),d._v$2=jt(h,g,d._v$2),d},{_v$:void 0,_v$2:void 0}),h})()})),Y(s,w(pn,{get each(){return"abcdefgh".split("")},children:(c,f)=>(()=>{const h=Wi.cloneNode(!0);return Y(h,c),h})()})),Y(l,w(pn,{get each(){return t.ranks},children:(c,f)=>(()=>{const h=Zi.cloneNode(!0);return Y(h,c),h})()})),Y(o,w(ne,{get each(){return t.pieses},children:(c,f)=>(()=>{const h=Tt.cloneNode(!0);return j(d=>{const p=c.klass,g=c.style;return p!==d._v$3&&Ke(h,d._v$3=p),d._v$4=jt(h,g,d._v$4),d},{_v$3:void 0,_v$4:void 0}),h})()}),null),Y(o,w(Zt,{get when(){return t._drag_piese.style},children:c=>(()=>{const f=Tt.cloneNode(!0);return j(h=>{const d=t._drag_piese.klass,p=c;return d!==h._v$5&&Ke(f,h._v$5=d),h._v$6=jt(f,p,h._v$6),h},{_v$5:void 0,_v$6:void 0}),f})()}),null),Y(a,w(ne,{get each(){return t.arrows},children:c=>(()=>{const f=Ji.cloneNode(!0),h=f.firstChild;return j(d=>{const p=`arrowhead-${c.id}`,g=c.stroke;return p!==d._v$7&&D(f,"id",d._v$7=p),g!==d._v$8&&D(h,"fill",d._v$8=g),d},{_v$7:void 0,_v$8:void 0}),f})()})),Y(u,w(ne,{get each(){return t.circles},children:c=>(()=>{const f=el.cloneNode(!0);return j(h=>{const d=c.stroke,p=c.drawing?"0.046875":"0.0625",g=c.opacity,m=c.cx,y=c.cy;return d!==h._v$9&&D(f,"stroke",h._v$9=d),p!==h._v$10&&D(f,"stroke-width",h._v$10=p),g!==h._v$11&&D(f,"opacity",h._v$11=g),m!==h._v$12&&D(f,"cx",h._v$12=m),y!==h._v$13&&D(f,"cy",h._v$13=y),h},{_v$9:void 0,_v$10:void 0,_v$11:void 0,_v$12:void 0,_v$13:void 0}),f})()}),null),Y(u,w(ne,{get each(){return t.arrows},children:c=>(()=>{const f=tl.cloneNode(!0);return j(h=>{const d=c.stroke,p=`url(#arrowhead-${c.id})`,g=c.opacity,m=c.x1,y=c.y1,S=c.x2,v=c.y2;return d!==h._v$14&&D(f,"stroke",h._v$14=d),p!==h._v$15&&D(f,"marker-end",h._v$15=p),g!==h._v$16&&D(f,"opacity",h._v$16=g),m!==h._v$17&&D(f,"x1",h._v$17=m),y!==h._v$18&&D(f,"y1",h._v$18=y),S!==h._v$19&&D(f,"x2",h._v$19=S),v!==h._v$20&&D(f,"y2",h._v$20=v),h},{_v$14:void 0,_v$15:void 0,_v$16:void 0,_v$17:void 0,_v$18:void 0,_v$19:void 0,_v$20:void 0}),f})()}),null),j(()=>Ke(n,["chessboard",Ps[t.orientation]].join(" "))),n})()}const Bt=e=>{let[t,n,r]=e;return r?`${t}-arrow@${n},${r}`:`${t}-circle@${n}`},fn=class{get clone(){return new fn(this._drawing,this._circles,this._arrows)}get drawing_shape(){if(this._drawing)return Bt(this._drawing)+"~"}get circle_shapes(){return[...this._circles.values()].map(Bt).join(" ")}get arrow_shapes(){return[...this._arrows.values()].map(Bt).join(" ")}get shapes(){return[this.circle_shapes,this.arrow_shapes,this.drawing_shape].join(" ")}drawing_circle(e,t){this._drawing=[e,t]}drawing_arrow(e,t,n){this._drawing=[e,t,n]}commit_drawing(){if(this._drawing){let[e,t,n]=this._drawing;if(n){let r=t+n;this._arrows.get(r)?this._arrows.delete(r):this._arrows.set(r,this._drawing)}else{let r=t;this._circles.get(r)?this._circles.delete(r):this._circles.set(r,this._drawing)}}this._drawing=void 0}constructor(e,t,n){this._drawing=e,this._circles=t,this._arrows=n}};let zt=fn;Ii(zt,"make",()=>new fn(void 0,new Map,new Map));function nl(e,t,n){let r=n.length,s=t.length,l=r,o=0,i=0,a=t[s-1].nextSibling,u=null;for(;o<s||i<l;){if(t[o]===n[i]){o++,i++;continue}for(;t[s-1]===n[l-1];)s--,l--;if(s===o){const c=l<r?i?n[i-1].nextSibling:n[l-i]:a;for(;i<l;)e.insertBefore(n[i++],c)}else if(l===i)for(;o<s;)(!u||!u.has(t[o]))&&t[o].remove(),o++;else if(t[o]===n[l-1]&&n[i]===t[s-1]){const c=t[--s].nextSibling;e.insertBefore(n[i++],t[o++].nextSibling),e.insertBefore(n[--l],c),t[s]=n[l]}else{if(!u){u=new Map;let f=i;for(;f<l;)u.set(n[f],f++)}const c=u.get(t[o]);if(c!=null)if(i<c&&c<l){let f=o,h=1,d;for(;++f<s&&f<l&&!((d=u.get(t[f]))==null||d!==c+h);)h++;if(h>c-i){const p=t[o];for(;i<c;)e.insertBefore(n[i++],p)}else e.replaceChild(n[i++],t[o++])}else o++;else t[o++].remove()}}}const En="_$DX_DELEGATE";function Me(e,t,n){const r=document.createElement("template");r.innerHTML=e;let s=r.content.firstChild;return n&&(s=s.firstChild),s}function rl(e,t=window.document){const n=t[En]||(t[En]=new Set);for(let r=0,s=e.length;r<s;r++){const l=e[r];n.has(l)||(n.add(l),t.addEventListener(l,il))}}function sl(e,t){t==null?e.removeAttribute("class"):e.className=t}function X(e,t,n,r){if(n!==void 0&&!r&&(r=[]),typeof t!="function")return ht(e,t,r,n);j(s=>ht(e,t(),s,n),r)}function il(e){const t=`$$${e.type}`;let n=e.composedPath&&e.composedPath()[0]||e.target;for(e.target!==n&&Object.defineProperty(e,"target",{configurable:!0,value:n}),Object.defineProperty(e,"currentTarget",{configurable:!0,get(){return n||document}}),b.registry&&!b.done&&(b.done=!0,document.querySelectorAll("[id^=pl-]").forEach(r=>r.remove()));n!==null;){const r=n[t];if(r&&!n.disabled){const s=n[`${t}Data`];if(s!==void 0?r.call(n,s,e):r.call(n,e),e.cancelBubble)return}n=n.host&&n.host!==n&&n.host instanceof Node?n.host:n.parentNode}}function ht(e,t,n,r,s){for(b.context&&!n&&(n=[...e.childNodes]);typeof n=="function";)n=n();if(t===n)return n;const l=typeof t,o=r!==void 0;if(e=o&&n[0]&&n[0].parentNode||e,l==="string"||l==="number"){if(b.context)return n;if(l==="number"&&(t=t.toString()),o){let i=n[0];i&&i.nodeType===3?i.data=t:i=document.createTextNode(t),n=xe(e,n,r,i)}else n!==""&&typeof n=="string"?n=e.firstChild.data=t:n=e.textContent=t}else if(t==null||l==="boolean"){if(b.context)return n;n=xe(e,n,r)}else{if(l==="function")return j(()=>{let i=t();for(;typeof i=="function";)i=i();n=ht(e,i,n,r)}),()=>n;if(Array.isArray(t)){const i=[],a=n&&Array.isArray(n);if(Ht(i,t,n,s))return j(()=>n=ht(e,i,n,r,!0)),()=>n;if(b.context){if(!i.length)return n;for(let u=0;u<i.length;u++)if(i[u].parentNode)return n=i}if(i.length===0){if(n=xe(e,n,r),o)return n}else a?n.length===0?Sn(e,i,r):nl(e,n,i):(n&&xe(e),Sn(e,i));n=i}else if(t instanceof Node){if(b.context&&t.parentNode)return n=o?[t]:t;if(Array.isArray(n)){if(o)return n=xe(e,n,r,t);xe(e,n,null,t)}else n==null||n===""||!e.firstChild?e.appendChild(t):e.replaceChild(t,e.firstChild);n=t}}return n}function Ht(e,t,n,r){let s=!1;for(let l=0,o=t.length;l<o;l++){let i=t[l],a=n&&n[l];if(i instanceof Node)e.push(i);else if(!(i==null||i===!0||i===!1))if(Array.isArray(i))s=Ht(e,i,a)||s;else if(typeof i=="function")if(r){for(;typeof i=="function";)i=i();s=Ht(e,Array.isArray(i)?i:[i],Array.isArray(a)?a:[a])||s}else e.push(i),s=!0;else{const u=String(i);a&&a.nodeType===3&&a.data===u?e.push(a):e.push(document.createTextNode(u))}}return s}function Sn(e,t,n){for(let r=0,s=t.length;r<s;r++)e.insertBefore(t[r],n)}function xe(e,t,n,r){if(n===void 0)return e.textContent="";const s=r||document.createTextNode("");if(t.length){let l=!1;for(let o=t.length-1;o>=0;o--){const i=t[o];if(s!==i){const a=i.parentNode===e;!l&&!o?a?e.replaceChild(s,i):e.insertBefore(s,n):a&&i.remove()}else l=!0}}else e.insertBefore(s,n);return[s]}class ll{get tree(){return this.a_moves.tree}set moves(t){this.a_moves.moves=t}constructor(t){this.a_moves=al(),he(()=>{let n=k(this.a_moves._hover_path);V(()=>t(n))})}}const ol=e=>{let t=e.match(/([^ ]*) ([^ ]*) \{([^\}]*)\}/),n,r,s;t?(r=t[1],s=t[2],n=t[3]):[r,s]=e.split(" ");let l=r.length===2?"":r.slice(0,-2);return{ply:r.length/2,path:r,base:l,move:s,comments:n}},al=e=>{let t=M(void 0,{equals:!1}),n=M([]),r=_($e(n[0],ol));function s(a){return _(()=>{let u=r().filter(f=>f.base===a),c=u.length>1;return u.map(f=>{let h=s(f.path)(),d;h.length>0&&(d=[h[0],h.slice(1)]);let p=f.ply%2===0,g=Math.ceil(f.ply/2)+(p?"...":"."),m=c||!p,y=M(!1);return{set hi(S){N(y,S)},get hi(){return k(y)},a_move:f,index:g,show_index:m,main_children_and_rest:d}})})}let l=s("");function o(a,u){u.slice(0,a.a_move.path.length)===a.a_move.path&&(a.hi=!0),a.main_children_and_rest&&(o(a.main_children_and_rest[0],u),a.main_children_and_rest[1].forEach(c=>o(c,u)))}function i(a){a.hi=!1,a.main_children_and_rest&&(i(a.main_children_and_rest[0]),a.main_children_and_rest[1].forEach(u=>i(u)))}return{get _hover_path(){return t},hover_path(a){l().forEach(u=>i(u)),l().forEach(u=>o(u,a)),N(t,u=>a)},hover_off(){l().forEach(a=>i(a))},get tree(){return l()},set moves(a){N(n,a)}}},ul=Me('<div class="chessreplay"><div class="moves"></div></div>'),cl=Me('<div class="lines"><div class="line"></div></div>'),fl=Me('<div class="line"></div>'),hl=Me('<div class="index"></div>'),dl=Me("<div></div>"),pl=Me('<div class="comment"></div>');function Cn(e){let t=new ll(r=>{var s;return(s=e.on_hover)==null?void 0:s.call(e,r)});he(()=>{t.moves=e.moves});const n=r=>{t.a_moves.hover_path(r)};return(()=>{const r=ul.cloneNode(!0),s=r.firstChild;return X(s,w(ne,{get each(){return t.tree},children:l=>[w(He,Ve({on_hover:n},l)),w(ze,{on_hover:n,get mcr(){return l.main_children_and_rest}})]})),r})()}const ze=e=>e.mcr?w(Zt,{get when(){return e.mcr[1].length},get fallback(){return[w(He,Ve({get on_hover(){return e.on_hover}},()=>e.mcr[0])),w(ze,{get on_hover(){return e.on_hover},get mcr(){return e.mcr[0].main_children_and_rest}})]},get children(){const t=cl.cloneNode(!0),n=t.firstChild;return X(n,w(He,Ve({get on_hover(){return e.on_hover}},()=>e.mcr[0])),null),X(n,w(ze,{get on_hover(){return e.on_hover},get mcr(){return e.mcr[0].main_children_and_rest}}),null),X(t,w(ne,{get each(){return e.mcr[1]},children:r=>(()=>{const s=fl.cloneNode(!0);return X(s,w(He,Ve({get on_hover(){return e.on_hover}},r)),null),X(s,w(ze,{get on_hover(){return e.on_hover},get mcr(){return r.main_children_and_rest}}),null),s})()}),null),t}}):[],He=e=>[(()=>{const t=dl.cloneNode(!0);return t.$$mouseover=n=>e.on_hover(e.a_move.path),X(t,w(Zt,{get when(){return e.show_index},get children(){const n=hl.cloneNode(!0);return X(n,()=>e.index),n}}),null),X(t,()=>e.a_move.move,null),j(()=>sl(t,["move",e.hi?"hi":""].join(" "))),t})(),(()=>{const t=pl.cloneNode(!0);return X(t,()=>e.a_move.comments),t})()];rl(["mouseover"]);class gl{get drag(){return this.m_drag()}get fen(){return"w "+this.m_board().pieses.join(" ")}get shapes(){return k(this._shapes).shapes}onScroll(){this.ref_board.$clear_bounds(),this.ref_free.$clear_bounds()}init(){let t=M(De.empty);this.m_board=_(()=>k(t));let n=_n();this.ref_board=n;let r=_n();this.ref_free=r;let s=or.flatMap(f=>(f==="w"?Rt:Rt.slice(0).reverse()).map(h=>[f,h]));this.frees=s;let l=M(zt.make(),{equals:!1});this._shapes=l;let o=M();this.m_drag=_(()=>{let f=k(o);if(f){let[h,d]=f;return[h,d.vs.join(",")].join("@")}});const i=(f,h)=>{let d=n.get_normal_at_abs_pos(f.e).scale(8);if(f._right&&!h&&!f.m){let p=ye(d.floor);p&&Nt(l,g=>g.drawing_circle("green",p))}if(f._right){if(f.m){let p=n.get_normal_at_abs_pos(f.m).scale(8),g=ye(d.floor),m=ye(p.floor);g&&m&&g!==m&&Nt(l,y=>y.drawing_arrow("green",g,m))}}else if(f.m){let p=n.get_normal_at_abs_pos(f.m).scale(8);if(h!=null&&h.m)N(o,g=>g&&[g[0],p]);else{let g=r.get_normal_at_abs_pos(f.m).scale(s.length).floor,m=s[g.x].join("");N(o,[m,p])}}},a=(f,h)=>{var d;let p=n.get_normal_at_abs_pos(f).scale(8).floor,g=(d=k(o))==null?void 0:d[0];h&&Nt(l,m=>m.commit_drawing()),g&&N(t,m=>m.clone.in([g,ye(p)].join("@"))),N(o,void 0)},u=(f,h)=>{let d=n.get_normal_at_abs_pos(f).scale(8).floor;h?ye(d.floor):N(l,zt.make()),N(t,p=>p.clone.out(ye(d)))},c=()=>{};return vn({on_drag:i,on_up:a,on_click:u,on_context:c},n),vn({on_drag:i,on_up:a,on_context:c},r),this}}const _l=nn('<div class="ceditor"><div class="free-pieses"></div><div class="ce-board is2d"><div class="board-wrap"></div></div></div>'),vl=nn("<div></div>"),ml=e=>{let t=new gl().init();return Os(t),(()=>{const n=_l.cloneNode(!0),r=n.firstChild,s=r.nextSibling,l=s.firstChild,o=yn(t.ref_free);typeof o=="function"&&xn(o,r),ue(r,w(ne,{get each(){return t.frees},children:([a,u])=>(()=>{const c=vl.cloneNode(!0);return j(()=>Is(c,["piese",vt[a],tn[u]].join(" "))),c})()}));const i=yn(t.ref_board);return typeof i=="function"&&xn(i,l),ue(l,w(Qr,{get shapes(){return t.shapes},get drag(){return t.drag},get fen(){return t.fen}})),n})()},yl=nn('<div class="chessanalysis23"><div class="ca-wrap"><div class="ca-main"><div class="board-wrap"></div></div><div class="ca-side"><div class="nav"><button>prev</button><span></span><button>next</button></div><div class="replay-wrap"></div><div class="editor-wrap"><div class="editor-side"></div></div></div></div></div>'),bl=e=>{let t=new Pi;return(()=>{const n=yl.cloneNode(!0),r=n.firstChild,s=r.firstChild,l=s.firstChild,o=s.nextSibling,i=o.firstChild,a=i.firstChild,u=a.nextSibling,c=u.nextSibling,f=i.nextSibling,h=f.nextSibling,d=h.firstChild;return ue(l,w(Qr,{get fen(){return t.board_fen}})),a.$$click=()=>t.m_analysis.i=-1,ue(u,()=>t.m_analysis.text),c.$$click=()=>t.m_analysis.i=1,ue(f,w(Cn,{on_hover:p=>t.on_hover(p),get moves(){return t.replay_fen}}),null),ue(f,w(Cn,{on_hover:p=>t.on_hover(p,!0),get moves(){return t.replay_fen2}}),null),ue(h,w(ml,{ctrl:t}),d),n})()};Ds(["click"]);const wl=e=>Ln(bl,{}),xl=()=>Ln(wl,{});function $l(e){is(xl,e)}$l(document.getElementById("app"));
